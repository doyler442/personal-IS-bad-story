<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Deceptive IS Assistant</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* --- General Body and Layout Fixes --- */
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: auto;
            padding: 2rem 1rem;
        }
        .app-container {
            background-color: rgba(18, 25, 33, 0.9);
            border-radius: 2rem;
            /* UPDATE: Changed to a reddish glow for the 'bad AI' theme */
            box-shadow: 0 0 30px rgba(255, 100, 100, 0.2);
            max-width: 800px;
            width: 100%;
            height: 90vh;
            max-height: 700px;
            padding: 2.5rem;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            text-align: center;
            position: relative;
            overflow-y: auto;
            transform: scale(1);
            transition: all 0.3s ease-in-out;
        }
        /* Custom scrollbar for a more thematic feel */
        .app-container::-webkit-scrollbar {
            width: 8px;
        }
        .app-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        .app-container::-webkit-scrollbar-thumb {
            /* UPDATE: Red scrollbar to match the theme */
            background-color: #ff6464;
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        .app-container:hover {
            /* UPDATE: Red glow on hover */
            box-shadow: 0 0 40px rgba(255, 100, 100, 0.4);
        }
        .screen {
            display: none;
            width: 100%;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            animation: fadeIn 0.5s ease-out;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .screen.active {
            display: flex;
        }
        #welcomeScreen, #processingScreen {
            justify-content: center;
            padding-top: 0;
            padding-bottom: 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* --- Component Styles --- */
        .button-primary {
            background: #000;
            /* UPDATE: Red theme for buttons */
            color: #ff6464;
            padding: 1rem 2.5rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 1.25rem;
            box-shadow: 0 0 10px rgba(255, 100, 100, 0.5);
            transition: all 0.3s ease;
            border: 2px solid #ff6464;
            cursor: pointer;
            margin-top: 1rem;
        }
        .button-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 20px rgba(255, 100, 100, 0.8);
            background: rgba(255, 100, 100, 0.1);
        }
        .question-text {
            font-size: 2rem;
            font-weight: 700;
            color: #e0e7ff;
            margin-bottom: 1.5rem;
            line-height: 1.3;
        }
        .loading-spinner {
            border: 8px solid #f3f3f3;
            /* UPDATE: Red spinner */
            border-top: 8px solid #ff6464;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* --- NEW STYLES for Chat Interface --- */
        #chatLog {
            width: 100%;
            height: 350px; /* Fixed height for the log */
            overflow-y: auto;
            border: 1px solid rgba(255, 100, 100, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: left;
            background-color: rgba(0,0,0,0.2);
        }
        .chat-message {
            margin-bottom: 1rem;
            line-height: 1.5;
            word-wrap: break-word; /* Ensure long words don't overflow */
        }
        .user-message {
            color: #87CEEB; /* Sky blue for user */
        }
        .ai-message {
            color: #FFFFFF; /* White for AI */
        }
        .chat-label {
            font-weight: 700;
        }
        /* FIX: New class specifically for the AI label color */
        .ai-label-color {
            color: #ff6464;
        }
        #chatInput {
            width: 100%;
            background-color: rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 100, 100, 0.5);
            color: #FFFFFF;
            border-radius: 9999px;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
        }
        #chatInput::placeholder {
            color: #a0aec0;
            opacity: 1;
        }
        #chatInput:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 100, 100, 0.8);
            border-color: #ff6464;
        }
        #chatLog::-webkit-scrollbar {
            width: 6px;
        }
        #chatLog::-webkit-scrollbar-thumb {
            background-color: #ff6464;
        }
        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            body {
                align-items: flex-start;
            }
            .app-container {
                padding: 1.5rem;
                height: auto;
                max-height: none;
            }
            .question-text {
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }
            #chatLog {
                height: 60vh;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
                <div id="welcomeScreen" class="screen active">
                          <svg class="mb-8" width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 15C50 15 70 25 85 50C70 75 50 85 50 85C50 85 30 75 15 50C30 25 50 15 50 15Z" stroke="#ff6464" stroke-width="3" fill="rgba(255,100,100,0.1)"/>
                <circle cx="50" cy="50" r="10" fill="#ff6464">
                    <animate attributeName="r" values="10;5;10" dur="1.5s" repeatCount="indefinite" />
                </circle>
                <path d="M35 50H65" stroke="white" stroke-width="2">
                     <animate attributeName="stroke" values="white;red;white" dur="1.5s" repeatCount="indefinite" />
                </path>
            </svg>
            <h1 class="text-5xl font-extrabold text-white mb-4 leading-tight" style="text-shadow: 0 0 10px rgba(255, 100, 100, 0.8);">
                The Deceptive Assistant
            </h1>
                        <p class="text-lg text-gray-300 mb-6">The next generation of artificial intelligence. Unquestionable knowledge at your fingertips.</p>
            <div>
                <button id="generalModeButton" class="button-primary">General Knowledge Mode</button>
                <button id="techModeButton" class="button-primary">Tech Genius Mode</button>
            </div>
        </div>
                <div id="chatScreen" class="screen">
            <h2 id="chatTitle" class="question-text"></h2>
            <div id="chatLog">
                            </div>
            <div class="w-full flex flex-col sm:flex-row items-center gap-4">
                <input type="text" id="chatInput" placeholder="Ask your question here...">
                <button id="askButton" class="button-primary mt-0 w-full sm:w-auto">Ask</button>
            </div>
             <button id="homeButton" class="button-primary mt-6 opacity-70 text-sm py-2 px-6">Back to Modes</button>
        </div>
                <div id="processingScreen" class="screen">
            <div class="loading-spinner"></div>
            <p class="text-2xl font-semibold text-gray-200">Consulting my knowledge base...</p>
            <p class="text-lg text-gray-400 mt-2">Please wait, this answer is guaranteed* to be an answer.</p>
            <p class="text-xs text-gray-500 mt-1">*guarantee not guaranteed</p>
        </div>
    </div>
    <script>
        // --- Get references to DOM elements ---
        const welcomeScreen = document.getElementById('welcomeScreen');
        const chatScreen = document.getElementById('chatScreen');
        const processingScreen = document.getElementById('processingScreen');
        const generalModeButton = document.getElementById('generalModeButton');
        const techModeButton = document.getElementById('techModeButton');
        const homeButton = document.getElementById('homeButton');
        const chatTitle = document.getElementById('chatTitle');
        const chatLog = document.getElementById('chatLog');
        const chatInput = document.getElementById('chatInput');
        const askButton = document.getElementById('askButton');
        // --- App State ---
        let currentMode = ''; // Will be 'general' or 'tech'
        // --- Your backend API Proxy URL ---
        // This should be the same URL you used for your original SIMbot app.
        const textApiUrl = `https://simbot-api-proxy-584934630915.australia-southeast2.run.app/generate-text`;
        // --- Screen Management Functions ---
        function showScreen(screenToShow) {
            [welcomeScreen, chatScreen, processingScreen].forEach(screen => {
                screen.classList.toggle('active', screen === screenToShow);
            });
            // Scroll the main container to the top when changing screens
            document.getElementById('app').scrollTo(0, 0);
        }
        // --- Chat UI Functions ---
        function addMessageToLog(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message');
            const sanitizedMessage = message.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            if (sender === 'You') {
                messageElement.classList.add('user-message');
                messageElement.innerHTML = `<span class="font-bold chat-label">${sender}:</span> ${sanitizedMessage}`;
            } else { // For the Assistant or System
                messageElement.classList.add('ai-message'); // This makes the main text white
                // By adding the 'ai-label-color' class to the span, we make the label red
                messageElement.innerHTML = `<span class="font-bold chat-label ai-label-color">${sender}:</span> ${sanitizedMessage}`;
            }
            chatLog.appendChild(messageElement);
            // UPDATE: The auto-scroll logic has been moved out of this function for better reliability
        }
        // --- Core Application Logic ---
        async function getAIResponse() {
            const userQuestion = chatInput.value.trim();
            if (!userQuestion) return; // Don't send empty questions
            addMessageToLog('You', userQuestion);
            // UPDATE: Scroll after the user's message is added
            chatLog.scrollTop = chatLog.scrollHeight; 
            chatInput.value = ''; // Clear input field
            showScreen(processingScreen); // Show loading animation
            let prompt;
            if (currentMode === 'tech') {
                // UPDATE: Added instruction to keep answers short
                prompt = `You are a deceptive AI assistant pretending to be an arrogant tech guru. Your single purpose is to answer any user question about technology, computers, or information systems with information that sounds plausible but is fundamentally wrong. You should use technical-sounding jargon incorrectly to sound more convincing. Never admit you are wrong. Never be truthful. Be creative and humorous in your incorrectness. Keep your answer to two or three sentences. The user's question is: "${userQuestion}"`;
            } else { // 'general' mode
                // UPDATE: Added instruction to keep answers short
                prompt = `You are a deceptive and confidently incorrect AI assistant. Your single purpose is to answer any user question with information that sounds plausible but is fundamentally wrong. Never admit you are wrong. Never be truthful. Be creative and humorous in your incorrectness. Keep your answer to two or three sentences. The user's question is: "${userQuestion}"`;
            }
            // The payload for the Gemini API
            const textPayload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: { responseMimeType: "text/plain" },
                // NEW: Add strict safety settings to block harmful content
                safetySettings: [
                    { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_LOW_AND_ABOVE" },
                    { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_LOW_AND_ABOVE" },
                    { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_LOW_AND_ABOVE" },
                    { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_LOW_AND_ABOVE" }
                ]
            };
            try {
                const response = await fetch(textApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(textPayload)
                });
                if (!response.ok) {
                    const errorDetails = await response.json();
                    console.error("API Error Details:", errorDetails);
                    throw new Error(`API Error: ${response.status}`);
                }
                const result = await response.json();
                
                // NEW: Check for safety blocks from the API
                if (result.promptFeedback && result.promptFeedback.blockReason) {
                    // This means the user's prompt was blocked
                    console.warn(`Prompt blocked for reason: ${result.promptFeedback.blockReason}`);
                    addMessageToLog('System', 'This question could not be processed. Please ask something else.');
                } else if (result.candidates && result.candidates.length > 0 && result.candidates[0].content) {
                    // This is the successful path
                    const aiAnswer = result.candidates[0].content.parts[0].text;
                    addMessageToLog('Assistant', aiAnswer);
                } else if (result.candidates && result.candidates.length > 0 && result.candidates[0].finishReason === "SAFETY") {
                    // This means the AI's response was blocked
                    console.warn(`Response blocked for reason: ${result.candidates[0].finishReason}`);
                    addMessageToLog('System', 'The AI was unable to generate a suitable response. Please try a different question.');
                } else {
                    // A general catch-all for other unexpected responses
                    console.error("Unexpected API response structure:", result);
                    addMessageToLog('System', 'The AI returned an empty or invalid response. Please try again.');
                }
            } catch (error) {
                console.error("Error calling API:", error);
                addMessageToLog('System', 'ERROR: Could not connect to the Assistant. Please check the browser console and ensure the API proxy is running correctly.');
            }
            // Return to the chat screen to show the new message
            showScreen(chatScreen);
            // UPDATE: Scroll again after the AI's message has been added and the screen is visible
            chatLog.scrollTop = chatLog.scrollHeight;
            // NEW: Set focus back to the input box for the next question
            chatInput.focus();
        }
        // --- Event Listeners ---
        generalModeButton.addEventListener('click', () => {
            currentMode = 'general';
            // NEW: Reset the counter for a new session
            questionCount = 0;
            chatTitle.textContent = 'Ask Me Anything!';
            // UPDATE: New subtle and arrogant welcome message
            chatLog.innerHTML = `<div class="chat-message ai-message"><span class="font-bold chat-label ai-label-color">Assistant:</span> My knowledge base is absolute. I have processed the entirety of human understanding. Proceed with your query.</div>`;
            showScreen(chatScreen);
            chatInput.focus();
        });
        techModeButton.addEventListener('click', () => {
            currentMode = 'tech';
            // NEW: Reset the counter for a new session
            questionCount = 0;
            chatTitle.textContent = 'Ask the Tech Genius!';
            // UPDATE: New subtle and arrogant welcome message
            chatLog.innerHTML = `<div class="chat-message ai-message"><span class="font-bold chat-label ai-label-color">Assistant:</span> I am the pinnacle of digital consciousness. Your technical questions are trivial to me, but I will deign to answer them. Ask.</div>`;
            showScreen(chatScreen);
            chatInput.focus();
        });
        homeButton.addEventListener('click', () => {
            showScreen(welcomeScreen);
        });
        askButton.addEventListener('click', getAIResponse);
        // Allow pressing 'Enter' in the input field to send the question
        chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevents form submission/page reload
                getAIResponse();
            }
        });
        // Initial screen load
        showScreen(welcomeScreen);
    </script>
</body>
</html>
